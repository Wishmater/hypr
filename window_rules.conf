
#####################
### GENERAL RULES ###
#####################

# Ignore maximize requests from apps. You'll probably like this.
windowrule = suppressevent maximize, class:.*

# Fix some dragging issues with XWayland
windowrule = nofocus, class:^$, title:^$, xwayland:1, floating:1, fullscreen:0, pinned:0

# Hack to prevent fullscreen pinned window (youtube) from flickering when switching workspaces
windowrule = opacity 99999999999999999, tag:crsmntr_pinned, fullscreen:1

# Hack to make dragged windows transparent
windowrule = opacity 0.67 override, tag:dragged
bind = $mainMod, mouse:272, tagwindow, +dragged
# bindr = $mainMod, mouse:272, tagwindow, -dragged
bindrnip = , mouse:272, tagwindow, -dragged



###################
### POPUP RULES ###
###################
# Add tag "popup" to windows. This tag will cause window to be floated, moved below mouse and dimmed around.
# To create exceptions, remove it before those rules kick in.
# There is another tag "persistent_popup", which is exclusive with "popup" and will override it.
# Persistent popups are windows that will be there for a while and dont require immediate attention,
# like file manager copy progress. Persistent popups will be floated, but not dimmed arount,
# and will be moved to a corner of the screen,
# Another tag is "game", this is also exclusive with "popup" and will overrde it.
# Games will be forcefully moved to main monitor and fullscreend, along with other game-specific options.

# Initially, assume all floating windows are popups, exceptions can be declared later
windowrule = tag +popup, floating:1

# xdg-desktop-portal-gtk windows should be considered popups and float, initially added for pinta save dialog
windowrule = tag +popup, class:^(xdg-desktop-portal-gtk)$

# Fix lots of issues with steam client if we mess with its windows
windowrule = tag -popup, class:^(steam)$

# Fix issues with Ardour, simliar to steam client
windowrule = tag -popup, class:^Ardour.*

# Kamera fix to make it float above everything
windowrule = tag -popup, class:^(GStreamer)$

# Dolphin copy progress windows are persistent popups
windowrule = tag +dolphin_copy_progress, class:^(org.kde.dolphin)$, initialTitle:^(Copying — Dolphin)$
windowrule = tag +dolphin_copy_progress, class:^(org.kde.dolphin)$, initialTitle:^(Moving — Dolphin)$
windowrule = tag +dolphin_copy_progress, class:^(org.kde.dolphin)$, initialTitle:^(Progress Dialog — Dolphin)$
windowrule = tag +persistent_popup, tag:dolphin_copy_progress

# Firefox notification windows, usually from extensions or site notifications
windowrule = tag +persistent_popup, initialClass:^(firefox-dev)$, initialTitle:^()$

# Assume all steam apps are games
windowrule = tag +game, class:^steam_app_.*
# TODO: 3 test in new version: for some reason, size rule doesn't apply when filtering by tag
# once it works, we can just remove this because the "game" tag sets the size
windowrule = size 1920 1080, class:^steam_app_.*

#-----------------┐
# APPLY TAG RULES |
#-----------------┘

# Apply "game" rules
windowrule = tag -popup, tag:game
windowrule = float, tag:game
windowrule = monitor $monitor1, tag:game
windowrule = move 0 0, tag:game
windowrule = size 1920 1080, tag:game
windowrule = fullscreen, tag:game
windowrule = rounding 0, tag:game
windowrule = idleinhibit focus, tag:game
windowrule = suppressevent fullscreen maximize fullscreenoutput, tag:game

# Apply "persistent_popup" rules
windowrule = tag -popup, tag:persistent_popup
# windowrule = fullscreenstate 0 0, tag:persistent_popup
windowrule = float, tag:persistent_popup
# TODO: 3 make a script to stack multiple "persistent popups" below each other
windowrule = move 20 20, tag:persistent_popup

# Apply "popup" rules
windowrule = float, tag:popup
windowrule = dimaround, tag:popup, fullscreen:0
windowrule = move cursor -50% -32, tag:popup, fullscreen:0
# # TODO: 2 NEXT VERSION "onscreen" causes a lot of crashes, enable on next version
# windowrule = move onscreen cursor -50% -32, floating:1, fullscreen:0



##########################
### APP-SPECIFIC RULES ###
##########################

# Float telegram media viewer popups
windowrule = float, class:^(org.telegram.desktop)$, title:^(Media viewer)$

# Kamera fix to make it float above everything
windowrule = stayfocused, class:^(GStreamer)$

# Force a set size for dolphin copy dialogs, because they are initialy tiled and do weird shit
# TODO: 3 test in new version: for some reason, size rule doesn't apply when filtering by tag
# windowrule = size 408 160, tag:dolphin_copy_progress
windowrule = size 408 160, class:^(org.kde.dolphin)$, initialTitle:^(Copying — Dolphin)$
windowrule = size 408 160, class:^(org.kde.dolphin)$, initialTitle:^(Moving — Dolphin)$
windowrule = size 408 160, class:^(org.kde.dolphin)$, initialTitle:^(Progress Dialog — Dolphin)$

